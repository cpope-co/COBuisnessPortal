<div class="table-container">

  <!-- Advanced Filters Section -->
  @if (config().showAdvancedFilters && hasData()) {
  <div class="advanced-filters-section mb-3">
    <co-filters [filterConfigs]="filterConfigs()" (filtersChanged)="onFiltersChanged($event)"
      (filtersCleared)="onFiltersCleared()" (searchOutput)="onSearchChange($event)">
    </co-filters>
  </div>
  }

  <!-- Table Section -->
  <div class="table-wrapper">
    <table mat-table [dataSource]="dataSource" matSort class="w-100" [style.display]="hasData() ? 'table' : 'none'">
      <!-- Dynamic Column Generation -->
      @for (column of columns(); track column.column) {
      <ng-container [matColumnDef]="column.column">
        @if (isSortable(column.column)) {
        <th mat-header-cell *matHeaderCellDef [mat-sort-header]="column.column">
          {{ column.label }}
        </th>
        } @else {
        <th mat-header-cell *matHeaderCellDef>
          {{ column.label }}
          @if (column.filterable !== false) {
          <mat-icon class="filter-icon">filter_list</mat-icon>
          }
        </th>
        }
        <td mat-cell *matCellDef="let element">
          {{ getCellValue(element, column.column) }}
        </td>
      </ng-container>
      }

      <!-- Header Row -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>

      <!-- Data Rows -->
      <tr mat-row *matRowDef="let row; columns: displayedColumns()" [class.clickable-row]="config().clickableRows"
        (click)="onRowClick(row)" (dblclick)="onRowDoubleClick(row)">
      </tr>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns().length">
          <div class="empty-state">
            <mat-icon class="empty-icon">search_off</mat-icon>
            <p class="empty-message">No results found</p>
            <p class="empty-subtitle">Try adjusting your search or filter criteria</p>
          </div>
        </td>
      </tr>
    </table>

  </div>

  <!-- Pagination Section - Always render but conditionally show -->
  <div class="pagination-section mt-3">
    <mat-paginator #tablePaginator [pageSize]="config().pageSize || 10"
      [pageSizeOptions]="config().pageSizeOptions || [10, 25, 50, 100]"
      [showFirstLastButtons]="config().showFirstLastButtons || true"
      [style.display]="config().showPagination && hasData() ? 'block' : 'none'" aria-label="Select page">
    </mat-paginator>
  </div>
</div>